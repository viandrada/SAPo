<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition>


	<script>
	var wsocket;
	//var serviceLocation = "ws://192.168.1.1:8080/hascode/chat/";
	
	var serviceLocation = "ws://localhost:8080/SAPo-FrontOffice/chat/";
	
	var $nickName;
	var $message;
	var $chatWindow;
	var $aux;
	var room = '';
 
	function onMessageReceived(evt) {
		//var msg = eval('(' + evt.data + ')');
		var msg = JSON.parse(evt.data); // native API
		var $messageLine = $('<tr> <td class=" pull-left col-xs-3" >' + msg.received
				+ '</td> <td class=" pull-left col-xs-4" >' + msg.sender
				+ '</td> <td class=" pull-left col-xs-5" >' + msg.message
				+ '</td></tr>');
		$chatWindow.append($messageLine);
		//$chatWindow.prepend($messageLine);

	}
	function sendMessage() {
		var msg = '{"message":"' + $message.val() + '", "sender":"'
				+ $nickName.val() + '", "received":""}';
		wsocket.send(msg);
		$message.val('').focus();
	}
 
	function connectToChatserver() {
		//room = $('#chatroom option:selected').val();
		room = $('#chatroom2').val();
		wsocket = new WebSocket(serviceLocation + room);
		wsocket.onmessage = onMessageReceived;
	}
 
	function leaveRoom() {
		wsocket.close();
		$chatWindow.empty();
		$('.chat-wrapper').hide();
		$('.chat-signin').show();
		$nickName.focus();
	}
 
	$(document).ready(function() {
		$nickName = $('#nickname');
		$message = $('#message');
		$chatWindow = $('#response');
		$('.chat-wrapper').hide();
		//$('.chat-wrapper').show();
		$nickName.focus();
 
		$('#enterRoom').click(function(evt) {
			evt.preventDefault();
			connectToChatserver();
			$('.chat-wrapper h2').text('Chat # '+$nickName.val() + "@" + room);
			$('.chat-signin').hide();
			$('.chat-wrapper').show();
			$message.focus();
		});
		$('#do-chat').submit(function(evt) {
			evt.preventDefault();
			sendMessage()
		});
 
		$('#leave-room').click(function(){
			leaveRoom();
		});
	});
	</script>

	<style type="text/css">
.bodycontainer {
	max-height: 200px;
	width: 100%;
	margin: 0;
	overflow-y: auto;
}

.table-scrollable {
	margin: 0;
	padding: 0;
}
</style>

	<div class="row"></div>
	<div class="container-fluid">

		<!-- Datos del almacen -->
		<div class="row">
			<!-- div class="col-xs-12 col-md-12 col-sm-12 col-lg-12">
				<h:outputLabel value="Id: " />
				#{navigationAreaBean.idAlmacenActual}
			</div-->
			<div class="col-xs-8 col-md-8 col-sm-8 col-lg-8">

				<h:outputText value="Almacén >> " class="h3" />
				<h:outputText value="#{almacenBean.almacen.nombre}" class="h2" />
				<h:outputText value=": " class="h2" />
				<h:outputText value="#{almacenBean.almacen.descripcion}" class="h2">
				</h:outputText>
			</div>

			<div class="col-xs-4 col-md-4 col-sm-4 col-lg-4">
				<h:outputText value="Usuarios de este almacen:" />
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th><h:outputText value="Nombre" /></th>
							<th><h:outputText value="Email" /></th>

						</tr>
					</thead>
					<tbody>
						<ui:repeat
							value="#{compartirAlmacenBean.listDataUsuQueCompartenAlmacen}"
							var="u">
							<tr>
								<td><h:outputText value="#{u.nombre}" /></td>
								<td><h:outputText value="#{u.email}" /></td>
							</tr>
						</ui:repeat>
					</tbody>
				</table>
				<BR />
			</div>

		</div>
		<hr />
		<!-- Fin de: Datos del almacen -->

		<div class="row">
			<h:form>
				<h:commandButton value="Chat"
					action="#{navigationAreaBean.goTo('Chat2.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Compartir Almacen"
					action="#{navigationAreaBean.goTo('compartirAlmacen.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Comentarios"
					action="#{navigationAreaBean.goTo('comentariosAlmacen.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Nuevo producto"
					action="#{navigationAreaBean.goTo('altaProducto.xhtml')}"
					actionListener="#{altaProductoBean.init()}" class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Nuevo producto (con plantilla)"
					action="#{navigationAreaBean.goTo('listarProductosGenericos.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Almacén ideal"
					action="#{navigationAreaBean.goTo('almacenIdeal.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<button type="button" class="btn btn-primary" data-toggle="modal"
					data-target="#myModalListaCompras"
					onclick="#{listaComprasBean.init()}">Generar lista de
					compras</button>

			</h:form>

		</div>
		<hr />
		<!-- Productos del almacen -->
		<div class="row">
			<ul class="list-group">
				<ui:repeat value="#{almacenBean.almacen.productos}" var="item">
					<div class="col-xs-6 col-sm-6 col-md-2 col-lg-2">
						<h:form id="modalForm">
							<li class="list-group-item"><h:outputText
									value="#{item.nombre}" /> <h:commandLink
									action="detalleProducto.xhtml"
									actionListener="#{detalleProductoBean.init(item.idProducto)}"
									class="thumbnail">
									<h:graphicImage class="img-responsive" style="height:100px;"
										value="Image/#{item.fotos.get(0).idImagen}">
									</h:graphicImage>
									<f:param name="Id" value="#{item.idProducto}" />
								</h:commandLink>
								<div class="row">
									<div
										class="col-xs-6 col-md-4 col-sm-2 col-lg-2 col-sm-offset-4 col-lg-offset-4">
										<h:commandButton
											action="#{almacenBean.actualizarStock(item.idProducto,item.stock - 1)}"
											value="-" />
									</div>
									<div class="col-xs-6 col-md-4 col-sm-3 col-lg-3">
										<h:outputText value="#{item.stock}" class="form-control" />
									</div>
									<div class="col-xs-6 col-md-4 col-sm-2 col-lg-2">
										<h:commandButton
											action="#{almacenBean.actualizarStock(item.idProducto,item.stock + 1)}"
											value="+" />
									</div>
								</div></li>
							<!-- Modal -->
							<div class="modal fade" id="myModalListaCompras" tabindex="-1"
								role="dialog" aria-labelledby="myModalLabel">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal"
												aria-label="Close">
												<span aria-hidden="true"></span>
											</button>
											<h4 class="modal-title" id="myModalLabel">Lista de
												compras</h4>
										</div>
										<div class="modal-body">
											<ui:include src="listaCompras.xhtml" />
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-info"
												data-dismiss="modal">Cancelar</button>
										</div>
									</div>
								</div>
							</div>
							<!-- Fin de ventana modal -->

						</h:form>
						<button type="button" class="btn btn-primary btn-lg"
							data-toggle="modal" data-target="#myModal"
							onclick="#{detalleProductoBean.init(item.idProducto)}">Ver
							detalle</button>

						<!-- Modal -->
						<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
							aria-labelledby="myModalLabel">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true"></span>
										</button>
										<h4 class="modal-title" id="myModalLabel">Detalle</h4>
									</div>
									<div class="modal-body">
										<ui:include src="detalleProducto.xhtml" />
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-info"
											data-dismiss="modal">Cancelar</button>
									</div>
								</div>
							</div>
						</div>
						<!-- Fin de ventana modal -->
					</div>
				</ui:repeat>
			</ul>
		</div>
		<!-- Fin de: Productos del almacen -->
		<div class="row">
			<div
				class="container chat-signin col-xs-4 col-md-4 col-sm-4 col-lg-4 col-xs-offset-8 col-md-offset-8 col-sm-offset-8 col-lg-offset-8">
				<form class="form-signin">
					<!-- <label for="nickname">Nickname</label> -->
					<h:inputHidden type="text" class="input-block-level"
						value="#{loginBean.email}" placeholder="Nickname" id="nickname" />

					<h:inputHidden type="text" class="input-block-level"
						value="#{almacenBean.almacen.idAlmacen}" placeholder="chatroom2"
						id="chatroom2" />

					<button class="btn btn-large btn-primary" type="submit"
						id="enterRoom">Chatear</button>

				</form>
			</div>

			<!-- <h:outputText value="Bienvenido, #{usuarioMB.mail}" rendered="#{not empty usuarioMB.mail}"/>/container -->

			<div
				class="chat-wrapper col-xs-4 col-md-4 col-sm-4 col-lg-4 col-xs-offset-8 col-md-offset-8 col-sm-offset-8 col-lg-offset-8">
				<form id="do-chat">
					<!-- <h2 class="alert alert-success"></h2> -->
					<!-- 	<div class="col-md-12">

			<table id="response" class="table table-striped">
			 <thead class="header">
            <tr>
              <th>Email Address</th>
              <th>First Name</th>
              <th>Last Name</th>
            
            </tr>
          </thead>
          <tbody>
				 </tbody>
			</table> -->
					<div class="bodycontainer scrollable">
						<table id="response"
							class="table table-hover table-striped table-condensed table-scrollable">
						</table>
					</div>

					<fieldset>
						<legend>Ingrese su mensaje...</legend>
						<div class="controls">
							<input type="text" class="form-control"
								placeholder="mi mensaje..." id="message" /> <input
								type="submit"
								class="btn btn-large btn-block btn-primary pull-left"
								style="margin-left: 0px;" value="Enviar" />
							<button class="btn btn-large btn-block pull-left" type="button"
								id="leave-room">Cerrar</button>
						</div>
					</fieldset>

				</form>
			</div>
		</div>
	</div>

</ui:composition>
</html>