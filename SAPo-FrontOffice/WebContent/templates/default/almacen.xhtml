<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition>

	<script src="resources/js/chat.js"></script>
	<link href="resources/css/areaTrabajo.css" />
	<!-- no me anduvo  -->

	<script>

	contenido_textarea = "" 
		num_caracteres_permitidos = 10 

		function valida_longitud(){ 
		   num_caracteres = document.forms[0].texto.value.length 

		   if (num_caracteres > num_caracteres_permitidos){ 
		      document.forms[0].texto.value = contenido_textarea 
		   }else{ 
		      contenido_textarea = document.forms[0].texto.value	
		   } 

		   if (num_caracteres >= num_caracteres_permitidos){ 
		      document.forms[0].caracteres.style.color="#ff0000"; 
		   }else{ 
		      document.forms[0].caracteres.style.color="#000000"; 
		   } 

		   cuenta() 
		} 
		function cuenta(){ 
		   document.forms[0].caracteres.value=document.forms[0].texto.value.length 
		} 

	</script>

	<style type="text/css">
.bodycontainer {
	max-height: 200px;
	width: 100%;
	margin: 0;
	overflow-y: auto;
}

.table-scrollable {
	margin: 0;
	padding: 0;
}
</style>

	<div class="container-fluid">

		<!-- Datos del almacen -->
		<div class="row">
			<div class="col-md-8 col-lg-8 visible-md visible-lg">
				<h:outputText value="Almacén >> " class="h3" />
				<h:outputText value="#{almacenBean.almacen.nombre}" class="h2" />
				<h:outputText value=": " class="h2" />
				<h:outputText value="#{almacenBean.almacen.descripcion}" class="h2">
				</h:outputText>
			</div>

			<div class="col-xs-12 col-sm-12 visible-xs visible-sm">
				<h:outputText value="Almacén >> " class="h3" />
				<h:outputText value="#{almacenBean.almacen.nombre}" class="h2" />
			</div>

			<ui:fragment
				rendered="#{!compartirAlmacenBean.listDataUsuQueCompartenAlmacen.isEmpty()}">
				<div
					class="col-xs-4 col-md-4 col-sm-4 col-lg-4 visible-md visible-lg">
					<h:outputText value="Usuarios de este almacen:" />
					<table class="table table-striped table-hover">
						<thead>
							<tr>
								<th><h:outputText value="Nombre" /></th>
								<th><h:outputText value="Email" /></th>

							</tr>
						</thead>
						<tbody>
							<ui:repeat
								value="#{compartirAlmacenBean.listDataUsuQueCompartenAlmacen}"
								var="u">
								<tr>
									<td><h:outputText value="#{u.nombre}" /></td>
									<td><h:outputText value="#{u.email}" /></td>
								</tr>
							</ui:repeat>
						</tbody>
					</table>
					<BR />
				</div>
			</ui:fragment>

			<ui:fragment
				rendered="#{compartirAlmacenBean.listDataUsuQueCompartenAlmacen.isEmpty()}">
				Solo tu eres Administrador de este Almacen.
			</ui:fragment>



		</div>
		<hr />
		<!-- Fin de: Datos del almacen -->

		<!-- Menu para dispositivos medianos y grandes -->
		<div class="row visible-md visible-lg">
			<h:form>
				<h:commandButton value="Nuevo producto"
					action="#{navigationAreaBean.goTo('altaProducto.xhtml')}"
					actionListener="#{altaProductoBean.init()}" class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Nuevo producto (con plantilla)"
					action="#{navigationAreaBean.goTo('listarProductosGenericos.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Chat"
					action="#{navigationAreaBean.goTo('chat.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Compartir Almacen"
					action="#{navigationAreaBean.goTo('compartirAlmacen.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Comentarios"
					action="#{navigationAreaBean.goTo('comentariosAlmacen.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Almacén ideal"
					action="#{navigationAreaBean.goTo('almacenIdeal.xhtml')}"
					class="btn btn-primary"></h:commandButton>
				<h:commandButton value="Lista de compras"
					action="#{navigationAreaBean.goTo('listaCompras.xhtml')}"
					class="btn btn-primary"></h:commandButton>
			</h:form>
		</div>

		<!-- Menu para dispositivos chicos y muy chicos -->
		<div class="row visible-xs visible-sm">
			<h:form>
				<div class="row">
					<div class="col-xs-4 col-sm-5">
						<h:commandButton value="Nuevo ítem" style="width: 100%"
							action="#{navigationAreaBean.goTo('altaProducto.xhtml')}"
							actionListener="#{altaProductoBean.init()}"
							class="btn btn-primary"></h:commandButton>
					</div>
					<div class="col-xs-7 col-sm-6 visible-xs visible-sm">
						<h:commandButton value="Nuevo ítem (c/ plantilla)"
							style="width: 100%"
							action="#{navigationAreaBean.goTo('listarProductosGenericos.xhtml')}"
							class="btn btn-primary"></h:commandButton>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-10 col-sm-10 col-xs-offset-1 col-sm-offset-1">
						<h:commandLink value=""
							action="#{navigationAreaBean.goTo('Chat2.xhtml')}" class="btn">
							<i class="fa fa-comments fa-2x"></i>
						</h:commandLink>
						<h:commandLink value=""
							action="#{navigationAreaBean.goTo('compartirAlmacen.xhtml')}"
							class="btn">
							<i class="fa fa-share-alt fa-2x"></i>
						</h:commandLink>
						<h:commandLink value=""
							action="#{navigationAreaBean.goTo('comentariosAlmacen.xhtml')}"
							class="btn">
							<i class="fa fa-comment fa-2x"></i>
						</h:commandLink>
						<h:commandLink value=""
							action="#{navigationAreaBean.goTo('almacenIdeal.xhtml')}"
							class="btn">
							<i class="fa fa-heart fa-2x"></i>
						</h:commandLink>
						<h:commandLink value=""
							action="#{navigationAreaBean.goTo('listaCompras.xhtml')}"
							class="btn">
							<i class="fa fa-list fa-2x"></i>
						</h:commandLink>
					</div>
				</div>
			</h:form>
		</div>
		<hr />
		<!-- Productos del almacen -->
		<div class="row">
			<ul class="list-group">
				<ui:repeat value="#{almacenBean.almacen.productos}" var="item">
					<div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
						<h:form id="modalForm">
							<li class="list-group-item">
								<div class="row">
									<div class="col-xs-9 col-sm-9 col-md-9 col-lg-9">
										<h:outputText value="#{item.nombre}" />
									</div>
									<div class="col-xs-2 col-sm-2 col-md-1 col-lg-1">
										<h:commandLink data-toggle="tooltip" data-placement="top"
											title="Editar"
											action="#{editarProductoEspBean.getProducto(item.idProducto)}"
											actionListener="#{navigationAreaBean.goTo('editarProductoEspecifico.xhtml')}"
											value="">
											<i class="fa fa-pencil-square-o"></i>
										</h:commandLink>
									</div>
									<div class="col-xs-2 col-sm-2 col-md-1 col-lg-1">
										<h:commandLink data-toggle="tooltip" data-placement="top"
											title="Configurar notificaciones"
											action="#{configurarNotificacionBean.init(item.idProducto)}"
											actionListener="#{navigationAreaBean.goTo('configurarNotificaciones.xhtml')}">
											<i class="fa fa-cog"></i>
										</h:commandLink>
									</div>
								</div> <h:commandLink
									actionListener="#{navigationAreaBean.goTo('detalleProducto.xhtml')}"
									action="#{detalleProductoEspBean.init(item.idProducto)}"
									class="thumbnail">
									<h:graphicImage class="img-responsive" style="height:100px;"
										value="Image/#{item.fotos.get(0).idImagen}">
									</h:graphicImage>
									<f:param name="Id" value="#{item.idProducto}" />
								</h:commandLink>
								<div class="row">
									<div class="col-xs-4 col-md-4 col-sm-2 col-lg-2">
										<h:form id="formMover">
											<h:commandLink value="Mover" class="btn btn-primary btn-xs"
												rendered="#{moverProductoBean.cantAlamcenenDeUsusario >= 2}"
												onclick="$('#myModal2').modal('show');document.getElementById('nombreCambiar:inputStock').value='#{item.stock}';document.getElementById('nombreCambiar:idProductoSelec').value='#{item.idProducto}';"
												immediate="true">
												<f:ajax execute="@this" render="formMover" />
											</h:commandLink>
										</h:form>
									</div>
									<div
										class="col-xs-2 col-md-4 col-sm-1 col-lg-1 col-sm-offset-5 col-lg-offset-5">
										<h:commandButton
											action="#{almacenBean.actualizarStock(item.idProducto,item.stock - 1)}"
											value="-" />
									</div>
									<div class="col-xs-2 col-md-4 col-sm-1 col-lg-1">

										<span class="badge">#{item.stock}</span>
									</div>
									<div class="col-xs-3 col-md-4 col-sm-1 col-lg-1">
										<h:commandButton
											action="#{almacenBean.actualizarStock(item.idProducto,item.stock + 1)}"
											value="+" />
									</div>

								</div>
							</li>
						</h:form>
						<!-- Modal -->
						<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
							aria-labelledby="myModalLabel">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true"></span>
										</button>
										<h4 class="modal-title" id="myModalLabel">Detalle</h4>
									</div>
									<div class="modal-body"></div>
									<div class="modal-footer">
										<button type="button" class="btn btn-info"
											data-dismiss="modal">Cancelar</button>
									</div>
								</div>
							</div>
						</div>
						<!-- Fin de ventana modal -->
					</div>
				</ui:repeat>
			</ul>
			<!-- Modal para Mover producto -->
			<div class="modal fade" id="myModal2" tabindex="-1" role="dialog"
				aria-labelledby="myModalLabel">
				<h:form id="nombreCambiar">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal">X</button>
								<h4 class="modal-title">Selecciona que cantidad y en que
									almacen quieres hacerlo...</h4>
							</div>
							<div class="modal-body">
								<div class="form-group">

									<h:inputHidden value="#{moverProductoBean.idProductoSelec}"
										id="idProductoSelec" name="idProductoSelec"
										class="form-control" />

									<label for="inputStock2">Stock:</label>
									<h:inputText class="form-control input-xs" id="inputStock"
										name="inputStock" value="#{moverProductoBean.cantStockAMover}">
									</h:inputText>

									<label for="sel1">Almacenes:</label>
									<h:selectOneMenu value="#{moverProductoBean.idAlmacenSelec}"
										class="form-control" id="sel12">
										<f:selectItems
											value="#{moverProductoBean.listaAlmacenesDeUsuarioMenosenElqueEsta}"
											var="c2" itemValue="#{c2.idAlmacen}" itemLabel="#{c2.nombre}" />
									</h:selectOneMenu>
								</div>


							</div>
							<div class="modal-footer">
								<h:commandButton class="btn btn-success" value="Mover"
									action="#{moverProductoBean.moverProducto}">
								</h:commandButton>

								<button type="button" class="btn btn-danger pull-left"
									data-dismiss="modal" onclick="return false;">Cancelar</button>
							</div>
						</div>
					</div>
				</h:form>
			</div>

			<!-- Fin de ventana modal -->
		</div>
		<!-- Fin de: Productos del almacen -->
		<footer class="footer">
			<!-- div data-spy="affix" data-offset-top="0" data-offset-bottom="0"-->
			<div class="navbar-fixed-bottom">
				<div
					class="container chat-signin col-xs-4 col-md-4 col-sm-4 col-lg-4 col-xs-offset-8 col-md-offset-8 col-sm-offset-8 col-lg-offset-8">
					<form class="form-signin">
						<!-- <label for="nickname">Nickname</label> -->
						<h:inputHidden type="text" class="input-block-level"
							value="#{loginBean.email}" placeholder="Nickname" id="nickname" />

						<h:inputHidden type="text" class="input-block-level"
							value="#{almacenBean.almacen.idAlmacen}" placeholder="chatroom2"
							id="chatroom2" />

						<ui:fragment
							rendered="#{!compartirAlmacenBean.listDataUsuQueCompartenAlmacen.isEmpty()}">
							<button style="width: 100%" class="btn btn-primary" type="submit"
								id="enterRoom">Chatear</button>
						</ui:fragment>

						<ui:fragment
							rendered="#{compartirAlmacenBean.listDataUsuQueCompartenAlmacen.isEmpty()}">
							No puedes Chatear, eres el unico Administrador.
						</ui:fragment>



					</form>
				</div>

				<!-- estaria bueno en vez de una tabla probar con otra cosa pq 
				cuando esta peque;o hay q scrolear el chat pq no se ve nada 
				lo que se me ocurrio fue hacer una columna y ir metiendole un div donde a dentro tenga
				un div para cada mensaje y dentro de ese div mensaje organizar la informacion-->

				<div
					class="chat-wrapper col-xs-4 col-md-4 col-sm-4 col-lg-4 col-xs-offset-8 col-md-offset-8 col-sm-offset-8 col-lg-offset-8">
					<form id="do-chat" style="background-color: rgb(119, 119, 119);">

						<div class="bodycontainer scrollable">
							<table id="response"
								class="table table-hover table-striped table-condensed table-scrollable">
								<thead>
									<tr>

										<th></th>
										<th></th>
										<th></th>

									</tr>
								</thead>
								<tbody>

								</tbody>

							</table>
						</div>

						<fieldset>
							<h4>
								<span class="label label-default">Ingrese su mensaje...</span>
							</h4>
							<div class="controls">
								<textarea class="form-control" rows="3" id="message"
									name="texto" onKeyDown="valida_longitud()"
									onKeyUp="valida_longitud()">
							</textarea>
								<input type="submit"
									class="btn btn-large btn-block btn-primary pull-left"
									style="margin-left: 0px;" value="Enviar" />
								<button class="btn btn-large btn-block pull-left" type="button"
									id="leave-room">Cerrar</button>
							</div>
						</fieldset>

					</form>
				</div>
			</div>
		</footer>
	</div>
</ui:composition>
</html>