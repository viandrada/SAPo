<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition>

	<div class="container-fluid">
		<h:outputStylesheet name="bootstrap/css/formulario.css" />
	<h:outputScript name="js/formulario.js" />
		<div class="row">
			<div class="col-xs-10 col-sm-10 col-md-10 col-lg-10">
				<h2>Producto nuevo (con plantilla)</h2>
			</div>
			<h:form>
				<div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
					<h:commandLink
						action="#{navigationAreaBean.goTo('listarProductosGenericos.xhtml')}">
						<i class="fa fa-times fa-2x">Cerrar</i>
					</h:commandLink>
				</div>
			</h:form>
		</div>
		<div class="row">
			<section>
				<div class="wizard">
					<div class="wizard-inner">
						<div class="connecting-line"></div>
						<ul class="nav nav-tabs" role="tablist">

							<li role="presentation" class="active"><a href="#step1"
								data-toggle="tab" aria-controls="step1" role="tab"
								title="Paso 1"> <span class="round-tab"> <i
										class="glyphicon glyphicon-pencil"></i>
								</span>
							</a></li>

							<li role="presentation" class="disabled"><a href="#step2"
								data-toggle="tab" aria-controls="step2" role="tab"
								title="Paso 2"> <span class="round-tab"> <i
										class="glyphicon glyphicon-pencil"></i>
								</span>
							</a></li>
							<li role="presentation" class="disabled"><a href="#step3"
								data-toggle="tab" aria-controls="step3" role="tab"
								title="Paso 3"> <span class="round-tab"> <i
										class="glyphicon glyphicon-picture"></i>
								</span>
							</a></li>

							<li role="presentation" class="disabled"><a href="#complete"
								data-toggle="tab" aria-controls="complete" role="tab"
								title="Fin"> <span class="round-tab"> <i
										class="glyphicon glyphicon-ok"></i>
								</span>
							</a></li>
						</ul>
					</div>

					<h:form id="altaProductoPlantilla" role="form">
						<div class="tab-content">
							<div class="tab-pane active" role="tabpanel" id="step1">
								<h3>Datos principales</h3>
								<!-- Nombre, stock y precio -->
								<div class="row">
									<div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
										<div class="row">
											<div class="form-group">
												<h:outputText class="form-control" id="outputNombre"
													value="#{altaProductoConPlantillaBean.productoGenerico.nombre}">
												</h:outputText>
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-2 col-lg-2">
												<h:outputText value="Stock " />
											</div>
											<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
												<div class="form-group">
													<h:inputText class="form-control input-lg" id="inputStock"
														value="#{altaProductoConPlantillaBean.productoNuevo.stock}">
														<f:validateBean for="inputStock" />
														<f:ajax event="keyup" render="inputTextMessageStock" />
													</h:inputText>
													<h:message id="inputTextMessageStock" for="inputStock"
														errorStyle="color:red;"></h:message>
												</div>
											</div>
											<div class="col-xs-12 col-sm-12 col-md-2 col-lg-2">
												<h:outputText value="Precio " />
											</div>
											<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
												<div class="form-group">
													<h:inputText class="form-control input-lg" id="inputPrecio"
														value="#{altaProductoConPlantillaBean.productoNuevo.precio}"
														a:placeholder="Precio">
														<f:validateBean for="inputPrecio" />
														<f:ajax event="keyup" render="inputTextMessagePrecio" />
													</h:inputText>
													<h:message id="inputTextMessagePrecio" for="inputPrecio"
														errorStyle="color:red;"></h:message>
												</div>
											</div>
										</div>
										<div class="row">
											<div class="form-group">
												<h:inputTextarea class="form-control" id="inputDescripcion"
													value="#{altaProductoConPlantillaBean.productoGenerico.descripcion}"
													a:maxlength="500" rows="5"
													a:placeholder="Escribe una descripcion aqui...">
													<f:validateBean for="inputDescripcion" />
													<f:ajax event="keyup" render="inputTextMessageDescripcion" />
												</h:inputTextarea>
												<h:message id="inputTextMessageDescripcion"
													for="inputDescripcion" errorStyle="color:red;"></h:message>
											</div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<h:graphicImage class="img-responsive"
													value="Image/#{altaProductoConPlantillaBean.productoGenerico.fotos.get(0).idImagen}">
												</h:graphicImage>
											</div>
										</div>
										<hr style="border-width: 3px;" />
										<!-- Separador -->
										<!-- Categoría -->
										<div class="row">
											<div class="form-group">
												<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3">
													<label for="sel1">Categoría:</label>
												</div>
												<div class="col-xs-6 col-sm-6 col-md-9 col-lg-9">
													<h:outputText class="form-control" id="inputNombreCat"
														value="#{altaProductoConPlantillaBean.productoGenerico.nombreCategoria}">
													</h:outputText>
												</div>
											</div>

										</div>
										<!-- Fin categoría -->
									</div>
								</div>
								<hr style="border-width: 3px;" />
								<!-- Separador -->
								<ul class="list-inline pull-right">
									<li><button type="button"
											class="btn btn-primary next-step">Continuar</button></li>
								</ul>
							</div>
							<div class="tab-pane" role="tabpanel" id="step2">
								<h3>Atributos</h3>
								<!-- Atributos que ya estaban (se agrega/cambia el valor) -->
								<h:dataTable
									value="#{altaProductoConPlantillaBean.atributosVista}"
									var="item" id="tablaAtributos" class="table">
									<h:column>
										<f:facet name="header">Nombre</f:facet>
										<h:outputText value="#{item.nombre}" />
										<h:inputHidden id="tipoDatoHidden" value="#{item.tipoDato}" />
									</h:column>
									<h:column>
										<f:facet name="header">Valor</f:facet>
										<div class="form-group" id="atributoTextoTabla1"
											style="display: block;">
											<h:inputText class="form-control" id="inputValorAtrTabla1"
												value="#{item.valor}" a:placeholder="Valor">
												<f:validateBean for="inputValorAtrTabla1" />
												<f:ajax event="keyup" render="inputTextMessage" />
											</h:inputText>
											<h:message id="inputTextMessageValorAtr"
												for="inputValorAtrTabla1" errorStyle="color:red;"></h:message>
										</div>
										<div class="form-group" id="atributoCalendarioTabla1"
											style="display: none;">
											<p:calendar value="#{item.valorFecha}" pattern="dd/MM/yyyy">
												<f:ajax event="dateSelect"
													listener="#{altaProductoConPlantillaBean.handleDateSelect}" />
											</p:calendar>
										</div>

										<div class="form-group" id="atributoNumeroTabla1"
											style="display: none;">
											<h:inputText class="form-control" id="atributoNumeroTabla1"
												value="#{item.valorNumero}" a:placeholder="Valor">
												<f:validateBean for="atributoNumeroTabla1" />
												<f:ajax event="keyup" render="inputTextMessage" />
											</h:inputText>
											<h:message id="inputTextMessageatributoNumero"
												for="inputValorAtr" errorStyle="color:red;"></h:message>
										</div>
									</h:column>
								</h:dataTable>

								<!-- Atributos nuevos (sólo se muestran porque el valor se setea en el momento) -->
								<h:dataTable
									value="#{altaProductoConPlantillaBean.atributosNuevosVista}"
									var="item" id="tablaAtributosAgregados" class="table">
									<h:column>
										<f:facet name="header">Nombre</f:facet>
										<h:outputText value="#{item.nombre}" />
									</h:column>
									<h:column>
										<f:facet name="header">Valor</f:facet>
										<div class="form-group" id="atributoTextoTabla2"
											style="display: block;">
											<h:outputText class="form-control" id="inputValorAtrTabla2"
												value="#{item.valor}" a:placeholder="Valor">
											</h:outputText>
											<h:message id="inputTextMessageValorAtr"
												for="inputValorAtrTabla2" errorStyle="color:red;"></h:message>
										</div>
									</h:column>
								</h:dataTable>

								<!-- Atributos genericos -->
								<div class="row">
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<div class="form-group">
											<h:inputText class="form-control" id="inputNombreAtr"
												value="#{altaProductoConPlantillaBean.nombreAtr}"
												a:placeholder="Nombre del atributo">
												<f:validateBean for="inputNombreAtr" />
												<f:ajax event="keyup" render="inputTextMessage" />
											</h:inputText>
											<h:message id="inputTextMessageNombreAtr"
												for="inputNombreAtr" errorStyle="color:red;"></h:message>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<div class="form-group">
											<h:selectOneMenu
												value="#{altaProductoConPlantillaBean.tipoDataAtr}"
												class="form-control" id="tipoDato"
												onchange="mostrarComponente()">
												<f:selectItems
													value="#{altaProductoConPlantillaBean.tipoDatoList}"
													var="e" itemValue="#{e}" itemLabel="#{e}"
													id="tipoDatoSelect" />
												<f:ajax event="change"
													listener="#{altaProductoConPlantillaBean.comboChangeListener}"></f:ajax>
											</h:selectOneMenu>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<div class="form-group" id="atributoTexto"
											style="display: block;">
											<h:inputText class="form-control" id="inputValorAtr"
												value="#{altaProductoConPlantillaBean.valorAtr}"
												a:placeholder="Valor">
												<f:validateBean for="inputNombreAtr" />
												<f:ajax event="keyup" render="inputTextMessage" />
											</h:inputText>
											<h:message id="inputTextMessageValorAtr" for="inputValorAtr"
												errorStyle="color:red;"></h:message>
										</div>

										<div class="form-group" id="atributoCalendario"
											style="display: none;">
											<rich:calendar
												value="#{altaProductoConPlantillaBean.valorAtributoFecha}"
												id="cal" pattern="dd/MM/yyyy">
												<f:ajax event="change"
													listener="#{altaProductoConPlantillaBean.handleDateSelect}"></f:ajax>
											</rich:calendar>
										</div>

										<div class="form-group" id="atributoNumero"
											style="display: none;">
											<h:inputText class="form-control" id="atributoNumero"
												value="#{altaProductoConPlantillaBean.valorAtributoNumero}"
												a:placeholder="Valor">
												<f:validateBean for="atributoNumero" />
												<f:ajax event="keyup" render="inputTextMessage" />
											</h:inputText>
											<h:message id="inputTextMessageatributoNumero"
												for="inputValorAtr" errorStyle="color:red;"></h:message>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<h:commandButton class="btn btn-primary" value="Agregar"
											actionListener="#{altaProductoConPlantillaBean.add}">
											<f:ajax
												render="altaProductoPlantilla:tablaAtributosAgregados" />
										</h:commandButton>
									</div>
								</div>
								<!-- Fin de: Atributos -->
								<ul class="list-inline pull-right">
									<li><button type="button"
											class="btn btn-default prev-step">Anterior</button></li>
									<li><button type="button"
											class="btn btn-default next-step">Saltar</button></li>
									<li><button type="button"
											class="btn btn-primary next-step">Continuar</button></li>
								</ul>
							</div>
							<div class="tab-pane" role="tabpanel" id="step3">
								<h3>Imágenes</h3>
								<div class="row">
									<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
										<rich:fileUpload
											fileUploadListener="#{altaProductoConPlantillaBean.listener}"
											style="width:100%;" id="upload"
											acceptedTypes=".jpg, .gif, .png, .bmp"
											ontyperejected="alert('Only JPG, GIF, PNG and BMP files are accepted');"
											maxFilesQuantity="5">
											<a4j:ajax event="uploadcomplete" execute="@none"
												render="info" />
										</rich:fileUpload>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
										<h:panelGroup id="info" layout="block" style="width: auto;">
											<rich:panel bodyClass="info">
												<f:facet name="header">
													<h:outputText value="Fotos cargadas" />
												</f:facet>
												<h:outputText value="No hay imagenes cargadas"
													rendered="#{altaProductoConPlantillaBean.size==0}" />
												<rich:dataGrid columns="1"
													value="#{altaProductoConPlantillaBean.fotos}" var="file"
													rowKeyVar="row">
													<rich:panel bodyClass="rich-laguna-panel-no-header">
														<h:panelGrid columns="2">
															<a4j:mediaOutput element="img" mimeType="image/jpeg"
																createContent="#{altaProductoConPlantillaBean.paint}"
																value="#{row}" style="height:15.5em;" cacheable="false">
																<f:param
																	value="#{altaProductoConPlantillaBean.timeStamp}"
																	name="time" />
															</a4j:mediaOutput>
															<h:panelGrid columns="2">
																<h:outputText value="Nombre:" />
																<h:outputText value=" #{file.nombre}" />
															</h:panelGrid>
														</h:panelGrid>
													</rich:panel>
												</rich:dataGrid>
											</rich:panel>
											<br />
											<a4j:commandButton
												action="#{altaProductoConPlantillaBean.clearUploadData}"
												render="info, upload" value="Limpiar fotos cargadas"
												rendered="#{altaProductoConPlantillaBean.size>0}" />
										</h:panelGroup>
									</div>
								</div>
								<ul class="list-inline pull-right">
									<li><button type="button"
											class="btn btn-default prev-step">Anterior</button></li>
									<li><button type="button"
											class="btn btn-default next-step">Saltar</button></li>
									<li><button type="button"
											class="btn btn-primary btn-info-full next-step">Continuar</button></li>
								</ul>
							</div>
							<div class="tab-pane" role="tabpanel" id="complete">
								<h3>Completo!</h3>
								<p>Haz completado todos los pasos correctamente. Haz click
									en Guardar para crear tu producto.</p>
								<h:commandButton class="btn btn-primary" value="Guardar"
									type="submit"
									action="#{navigationAreaBean.goTo('almacen.xhtml')}"
									actionListener="#{altaProductoConPlantillaBean.altaProducto}">
								</h:commandButton>


							</div>
							<div class="clearfix"></div>
						</div>
					</h:form>
				</div>
			</section>
		</div>
	</div>
	<script type="text/javascript">

               function mostrarComponente()
               {

                  var tipoDato;
                  tipoDato = document.getElementById('altaProductoPlantilla:tipoDato').value;

                  document.getElementById('atributoTexto').style.display='none';
                  document.getElementById('atributoCalendario').style.display='none';
                  document.getElementById('atributoNumero').style.display='none';

                  switch(tipoDato)
                  {
                    case "Texto":
                       document.getElementById('atributoTexto').style.display='block';
                       break;
                    case "Fecha":
                       document.getElementById('atributoCalendario').style.display='block';      
                       break;
                    case "Numero":
                        document.getElementById('atributoNumero').style.display='block';      
                        break;
                    default:
                    	document.getElementById('atributoTexto').style.display='block';
                        break;
                  }
                  
               }
     </script>
	<script type="text/javascript">

               function cambiarControl()
               {

            	   var tipoDato;
                   tipoDato = document.getElementById('altaProductoPlantilla:tipoDatoHidden2').value;

                   document.getElementById('inputValorAtrTabla2').style.display='none';
                   document.getElementById('atributoCalendarioTabla2').style.display='none';
                   document.getElementById('atributoNumeroTabla2').style.display='none';

                   switch(tipoDato)
                   {
                     case "Texto":
                        document.getElementById('inputValorAtrTabla2').style.display='block';
                        break;
                     case "Fecha":
                        document.getElementById('atributoCalendarioTabla2').style.display='block';      
                        break;
                     case "Numero":
                         document.getElementById('atributoNumeroTabla2').style.display='block';      
                         break;
                     default:
                     	document.getElementById('inputValorAtrTabla2').style.display='block';
                         break;
                   }
                  
               }
     </script>
	<script>
     window.onload = function() {
         var tipoDato;
         tipoDato = document.getElementById('altaProductoPlantilla:tipoDatoHidden').value;

         document.getElementById('inputValorAtrTabla1').style.display='none';
         document.getElementById('atributoCalendarioTabla1').style.display='none';
         document.getElementById('atributoNumeroTabla1').style.display='none';

         switch(tipoDato)
         {
           case "Texto":
              document.getElementById('inputValorAtrTabla1').style.display='block';
              break;
           case "Fecha":
              document.getElementById('atributoCalendarioTabla1').style.display='block';      
              break;
           case "Numero":
               document.getElementById('atributoNumeroTabla1').style.display='block';      
               break;
           default:
           	document.getElementById('inputValorAtrTabla1').style.display='block';
               break;
         }
    	};
     </script>
</ui:composition>
</html>